<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .pale-blue-bg { background-color: #f0f7ff; }
        .pale-blue-card { background-color: #ffffff; border: 1px solid #e1effe; }
        .btn-primary { background-color: #3b82f6; color: white; transition: all 0.2s; }
        .btn-primary:hover { background-color: #2563eb; transform: translateY(-1px); }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="pale-blue-bg min-h-screen text-slate-800">
    <div id="app" class="max-w-3xl mx-auto px-4 py-12">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-blue-900 mb-2">Quiz Generator</h1>
            <p class="text-slate-500">Transform any text into a quiz instantly</p>
        </header>

        <div id="setup-view" class="pale-blue-card rounded-2xl p-8 shadow-sm">
            <div class="mb-6">
                <label class="block text-sm font-semibold mb-2">Paste your paragraph</label>
                <textarea id="quiz-text" class="w-full h-48 p-4 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none resize-none" placeholder="Enter text here..."></textarea>
            </div>
            <div class="mb-8">
                <label class="block text-sm font-semibold mb-2">Number of questions (Max 50)</label>
                <input type="number" id="quiz-count" value="5" min="1" max="50" class="w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <button onclick="generateQuiz()" id="generate-btn" class="w-full py-4 rounded-xl btn-primary font-bold text-lg shadow-lg shadow-blue-200">
                Generate Quiz
            </button>
        </div>

        <div id="quiz-view" class="hidden">
            <div class="mb-8 flex justify-between items-end">
                <div>
                    <h2 class="text-2xl font-bold text-blue-900">Your Quiz</h2>
                    <p id="progress-text" class="text-slate-500">Question 1 of 5</p>
                </div>
                <div id="progress-bar-container" class="w-32 h-2 bg-slate-200 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-blue-500 w-0 transition-all duration-300"></div>
                </div>
            </div>
            <div id="question-container" class="pale-blue-card rounded-2xl p-8 shadow-md mb-8"></div>
            <div class="flex justify-between items-center">
                <button onclick="previousQuestion()" id="prev-btn" class="text-slate-400 font-semibold hover:text-slate-600 disabled:opacity-50">‚Üê Previous</button>
                <button onclick="nextQuestion()" id="next-btn" class="px-8 py-3 rounded-full btn-primary font-bold shadow-md">Next Question ‚Üí</button>
            </div>
        </div>

        <div id="result-view" class="hidden text-center">
            <div class="pale-blue-card rounded-2xl p-12 shadow-lg mb-8">
                <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <span class="text-4xl">üèÜ</span>
                </div>
                <h2 class="text-3xl font-bold text-blue-900 mb-2">Quiz Complete!</h2>
                <div id="score-display" class="text-5xl font-bold text-blue-600 my-6">0%</div>
                <p id="stats-text" class="text-slate-500 mb-8">You got 0 out of 5 correct</p>
                <button onclick="resetApp()" class="px-8 py-3 rounded-xl border-2 border-blue-500 text-blue-600 font-bold hover:bg-blue-50 transition-colors">
                    Try Another Quiz
                </button>
            </div>
        </div>
    </div>
<script>
let quizData = [];
let currentIdx = 0;
let userAnswers = {};

const STOPWORDS = new Set(["the","and","with","that","this","from","have","were","which","their","about","there","into","while","where","when","what","your","each","many","some","such","than","then","also","because"]);

function normalize(s){ return (s||"").toLowerCase().replace(/[^\w\s]/g,"").trim(); }
function shuffle(a){ return a.sort(()=>Math.random()-0.5); }

function splitSentences(text){
  return text.split(/(?<=[.!?])\s+/).filter(s=>s.length>25);
}

function extractKeywords(text){
  let words=text.replace(/[^\w\s]/g,"").split(/\s+/).filter(w=>w.length>4 && !STOPWORDS.has(w.toLowerCase()));
  return [...new Set(words)];
}

// ============ QUIZ GENERATOR ============
function generateQuiz(){
  const text=document.getElementById("quiz-text").value.trim();
  const count=Math.min(parseInt(document.getElementById("quiz-count").value)||5,50);
  const btn=document.getElementById("generate-btn");

  if(text.length<80){ alert("Please enter a longer paragraph."); return; }

  btn.disabled=true;
  btn.innerHTML='<span class="loader mr-2"></span> AI generating...';

  setTimeout(()=>{
    const sentences=splitSentences(text);
    const keywords=extractKeywords(text);
    quizData=[];
    let used=new Set();

    for(let i=0;i<count;i++){
      const type=["mcq","tf","blank"][i%3]; // forces 3 types repeatedly
      const kw=keywords[Math.floor(Math.random()*keywords.length)];
      if(!kw||used.has(kw)) continue;
      used.add(kw);

      const sentence=sentences.find(s=>s.toLowerCase().includes(kw.toLowerCase()))||sentences[0];

      if(type==="blank"){
        quizData.push({
          type:"blank",
          question:"Fill in the blank:\n"+sentence.replace(new RegExp(kw,"i"),"________"),
          answer:kw
        });
      }

      else if(type==="mcq"){
        let options=shuffle([kw,...shuffle(keywords.filter(w=>w!==kw)).slice(0,3)]);
        quizData.push({
          type:"mcq",
          question:"Which term best fits this context?\n"+sentence.slice(0,100)+"...",
          options,
          answer:kw
        });
      }

      else if(type==="tf"){
        let trueStmt=Math.random()<0.5;
        let statement=trueStmt?sentence:sentence.replace(new RegExp(kw,"i"),"something else");
        quizData.push({
          type:"tf",
          question:'True or False:\n"'+statement+'"',
          answer:trueStmt?"True":"False"
        });
      }
    }

    currentIdx=0;
    userAnswers={};
    showView("quiz-view");
    renderQuestion();

    btn.disabled=false;
    btn.innerText="Generate Quiz";
  },1000);
}

// ============ RENDER ============
function renderQuestion(){
  const q=quizData[currentIdx];
  const container=document.getElementById("question-container");
  const progress=((currentIdx+1)/quizData.length)*100;
  document.getElementById("progress-bar").style.width=progress+"%";
  document.getElementById("progress-text").innerText="Question "+(currentIdx+1)+" of "+quizData.length;
  document.getElementById("prev-btn").disabled=currentIdx===0;
  document.getElementById("next-btn").innerText=currentIdx===quizData.length-1?"Finish Quiz":"Next Question ‚Üí";

  let html='<h3 class="text-xl font-semibold mb-6 whitespace-pre-line">'+q.question+'</h3>';

  if(q.type==="mcq"){
    html+='<div class="space-y-3">';
    q.options.forEach(opt=>{
      const active=userAnswers[currentIdx]===opt?"bg-blue-50 border-blue-500":"border-slate-200 hover:bg-slate-50";
      html+=`<button onclick="saveAnswer('${opt}')" class="w-full text-left p-4 rounded-xl border-2 ${active}">${opt}</button>`;
    });
    html+='</div>';
  }

  else if(q.type==="tf"){
    html+='<div class="grid grid-cols-2 gap-4">';
    ["True","False"].forEach(opt=>{
      const active=userAnswers[currentIdx]===opt?"bg-blue-50 border-blue-500":"border-slate-200 hover:bg-slate-50";
      html+=`<button onclick="saveAnswer('${opt}')" class="p-8 rounded-xl border-2 font-bold ${active}">${opt}</button>`;
    });
    html+='</div>';
  }

  else{
    html+=`<input type="text" oninput="saveAnswer(this.value)" value="${userAnswers[currentIdx]||""}" class="w-full p-4 rounded-xl border-2 border-slate-200 focus:border-blue-500" placeholder="Type answer...">`;
  }

  container.innerHTML=html;
}

// ============ LOGIC ============
function saveAnswer(v){ userAnswers[currentIdx]=v; if(quizData[currentIdx].type!=="blank") renderQuestion(); }
function nextQuestion(){ if(!userAnswers[currentIdx]){alert("Please answer.");return;} currentIdx<quizData.length-1?(currentIdx++,renderQuestion()):showResults(); }
function previousQuestion(){ if(currentIdx>0){currentIdx--;renderQuestion();}}

function showResults(){
  let score=0;
  quizData.forEach((q,i)=>{
    if(normalize(userAnswers[i])===normalize(q.answer)) score++;
  });
  const p=Math.round((score/quizData.length)*100);
  document.getElementById("score-display").innerText=p+"%";
  document.getElementById("stats-text").innerText=`You got ${score} out of ${quizData.length} correct`;
  showView("result-view");
}

function showView(v){["setup-view","quiz-view","result-view"].forEach(id=>document.getElementById(id).classList.toggle("hidden",id!==v));}
function resetApp(){document.getElementById("quiz-text").value="";showView("setup-view");}
</script>


</body>
</html>
